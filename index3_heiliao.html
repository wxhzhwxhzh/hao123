<!DOCTYPE html>
<html lang="zh-CN">



<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <title>WangXianSheng视频站</title>

    <!-- 装饰栏 开始 -->
    <style>
        body {

            background-color: #f3f3f5;
            text-align: center;



        }

        .juzhong {
            position: absolute;
            left: 10%;
            right: 10%;
        }



        h1 {
            color: #244981;
        }

        #randomButton {
            height: 50px;
            background-color: chocolate;
            border-radius: 8px;
            /* 设置按钮的高度为50像素 */
        }

        .pp {
            height: 50px;
            background-color: chocolate;

        }
    </style>

    <!-- 装饰栏  结束 -->




</head>







<body>

    <!-- 页面主体 start -->
    <div class="juzhong">

        <h1>WangXianSheng视频站</h1>


        <div id="pics"> </div>
        <br />
        <br />
        <button class="pp" onclick="prevSlide()">上一张</button>
        <button class="pp" onclick="nextSlide()">下一张</button>
        <br />
        <br />
        <p class="turn_to_red">点击下面按钮刷新下一个视频</p>
        <button id="randomButton" onclick="updateRandomUrl()">刷新</button>
        <br />
        <br />
        <div id="dplayer"></div>
        <br />
        <br />
        <button id="getText">刷新版权所有</button>
        <br />
        <a id="raw_url" href='https://www.bi1ibili.com/m3u8/3/3025/index.m3u8' target="_blank">访问原始网页</a>
        <br />

        <div id="info">版权所有</div>


    </div>
    <!-- 页面主体 end -->




    <!-- 脚本栏start -->


    <script src="https://cdnjs.cloudflare.com/ajax/libs/dplayer/1.27.1/DPlayer.min.js" crossorigin="anonymous"
        referrerpolicy="no-referrer"></script>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> <!-- 引入jQuery -->


    <script>
        //jQuery  自定义函数插件
        $.fn.backgroud = function (c) {
            this.css('backgroundColor', c);
            return this;
        }

        // jQuery的链式调用 操作css  
        $('.turn_to_red').css('color', 'blue');
        $('#randomButton').css('min-width', '150px').backgroud('lightgreen');
        $('#getText').css('min-width', '150px').css('height', '50px').backgroud('chocolate');

        //Ajax  异步读取url.txt
        $('#getText').click(function () {
            $.ajax({
                url: 'url.txt',
                method: 'GET',
                dataType: 'text',
                success: function (response) {
                    $('#info').text(response);
                }, error: function () {
                    console.log('请求失败');
                    alert('请求失败');
                }
            });
        });


    </script>

    <script>
        //引入Dplayer
        var raw_url = "https://heiliao385.pro/archives/2191.html";

        const dp = new DPlayer({
            container: document.getElementById('dplayer'),
            screenshot: true,
            logo: './img/logo.ico',
            video: {
                url: 'https://www.bi1ibili.com/m3u8/3/3025/index.m3u8',
                pic: './img/01.jpg',
                thumbnails: 'thumbnails.jpg',
            },
            subtitle: {
                url: 'webvtt.vtt',
            },
            danmaku: {
                id: 'demo',
                api: 'https://api.prprpr.me/dplayer/',
            },
        });


    </script>

    <script>
        updateRandomUrl();
        // 更新随机URL
        function updateRandomUrl() {
            // 生成随机数字
            var num = generateRandomNumber();

            // 构建m3u8_url和pic_urls
            var m3u8_url = `https://www.bi1ibili.com/m3u8/${num[0]}/${num}/index.m3u8`;
            var new_raw_url = raw_url.replace("2191", num);

            //由一个数组生成另一个数组  获取图片url的批量地址
            const array = [1, 2, 3, 4, 5,6];
            //map  高阶函数    箭头函数   模版字符串
            var pic_urls = array.map(x => `https://heiliao391.pro/files/image/${num[0]}/${num}/${num}-${x}.jpg`);





            // 更新按钮文本为m3u8_url  界面元素先隐藏后渐变！
            $('#dplayer').hide().show(1000);
            $('#randomButton').text('刷新 ' + m3u8_url).hide().show(2000);
            $('.pics_content').show(2000);




            //更新链接文本
            $('#raw_url').attr('href', new_raw_url);
            $('#raw_url').text(new_raw_url);

            // 暂停视频播放，并切换视频源和封面图
            dp.pause();
            dp.switchVideo({
                url: m3u8_url,
                pic: './img/01.jpg'
            });




            // 插入图片
            insertImages(pic_urls);




        }

        // 生成随机数字
        function generateRandomNumber() {
            var randomNumber = Math.floor(Math.random() * (3400 - 1500 + 1)) + 1500;
            return randomNumber.toString();
        }

        // 插入图片
        function insertImages(urls) {
            var div = $('#pics');     // document.getElementById("pics");
            div.empty(); //清空div

            urls.forEach((url) => {
                let img = $('<img>').addClass('pics_content').attr('src', url).css('width', '80%');    //创建新的img标签 并赋值 隐藏
                let p_txt=$('<a>').text(url);   //创建新的a标签 并赋值
                
                checkImageURL(url, (isValid) => { if (isValid) { div.append(img) } else {div.append(p_txt)} });  //图片url有效就添加图片标签    无效就添加文本标签
            }


            );

        }

        //Ajax 检测图片url是否有效
        function checkImageURL(url, callback) {
            let img = new Image();
            img.onload = function () {
                callback(true);
            };
            img.onerror = function () {
                callback(false);
                
            };
            img.src = url;
        }


    </script>








    <script>
        // 获取所有 class 为 "dengbili" 的元素
        var elements = document.getElementsByClassName("dengbili");

        // 遍历每个符合条件的元素
        for (var i = 0; i < elements.length; i++) {
            var element = elements[i];
            element.style.width = "80%";
            var width = element.offsetWidth; // 获取元素的宽度
            element.style.height = width * 0.5 + "px"; // 设置高度为宽度的一半
        }



    </script>

    <!-- 脚本栏end     -->

</body>

</html>
